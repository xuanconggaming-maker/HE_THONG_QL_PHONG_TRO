<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω T√†i Kho·∫£n Kh√°ch H√†ng - Xu√¢n C√¥ng</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        background: #f4f7f6;
        font-family: "Segoe UI", sans-serif;
        padding: 30px;
      }
      .container {
        max-width: 1000px;
        margin: auto;
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .header-flex {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #eee;
        padding-bottom: 15px;
        margin-bottom: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #2c3e50;
        color: white;
      }
      .btn-back {
        text-decoration: none;
        color: #2c3e50;
        font-weight: bold;
        border: 1px solid #2c3e50;
        padding: 8px 15px;
        border-radius: 5px;
        transition: 0.3s;
      }
      .btn-back:hover {
        background: #2c3e50;
        color: white;
      }
      .btn-delete {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
      }
      .status-badge {
        background: #2ecc71;
        color: white;
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header-flex">
        <h2 style="color: #2c3e50">üë• QU·∫¢N L√ù T√ÄI KHO·∫¢N KH√ÅCH H√ÄNG</h2>
        <a href="trangchu-admin.html" class="btn-back">‚Üê Quay l·∫°i Admin</a>
      </div>

      <table>
        <thead>
          <tr>
            <th>STT</th>
            <th>T√™n ƒëƒÉng nh·∫≠p</th>
            <th>Email li√™n h·ªá</th>
            <th>M·∫≠t kh·∫©u (·∫®n)</th>
            <th>S·ªë d∆∞ v√≠</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody id="userTableBody"></tbody>
      </table>
    </div>

    <style>
      /* ... (Gi·ªØ nguy√™n CSS c≈© v√† th√™m c√°c style m·ªõi b√™n d∆∞·ªõi) ... */
      .btn-edit {
        background: #3498db;
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 5px;
      }
      .password-container {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn-view {
        cursor: pointer;
        background: none;
        border: none;
        font-size: 16px;
      }
      /* T·∫°o khung cu·ªôn cho b·∫£ng tr√™n ƒëi·ªán tho·∫°i */
      .container {
        max-width: 1000px;
        margin: auto;
        background: white;
        padding: 15px; /* Gi·∫£m b·ªõt kho·∫£ng c√°ch l·ªÅ tr√™n mobile */
        border-radius: 12px;
        overflow-x: auto; /* T·ª± ƒë·ªông hi·ªán thanh cu·ªôn ngang n·∫øu b·∫£ng qu√° r·ªông */
      }

      @media (max-width: 600px) {
        .header-flex {
          flex-direction: column; /* Chuy·ªÉn ti√™u ƒë·ªÅ l√™n tr√™n, n√∫t quay l·∫°i xu·ªëng d∆∞·ªõi */
          text-align: center;
          gap: 15px;
        }

        /* ·∫®n b·ªõt c·ªôt Email tr√™n ƒëi·ªán tho·∫°i nh·ªè ƒë·ªÉ ∆∞u ti√™n xem m·∫≠t kh·∫©u v√† s·ªë d∆∞ */
        th:nth-child(3),
        td:nth-child(3) {
          display: none;
        }
      }
    </style>

    <tbody id="userTableBody"></tbody>

    <script>
      function renderUsers() {
        let users = JSON.parse(localStorage.getItem("usersList")) || [];
        let html = "";

        users.forEach((u, index) => {
          let balance = localStorage.getItem("balance_" + u.username) || 0;

          html += `
                <tr>
                    <td>${index + 1}</td>
                    <td><b>${u.username}</b></td>
                    <td>${u.email}</td>
                    <td>
                        <div class="password-container">
                            <span id="pass-${index}">******</span>
                            <button class="btn-view" onclick="togglePassword(${index}, '${u.password}')">üëÅÔ∏è</button>
                        </div>
                    </td>
                    <td style="color: #27ae60; font-weight: bold;">${parseInt(balance).toLocaleString()}ƒë</td>
                    <td>
                        <button class="btn-edit" onclick="changePassword('${u.username}')">üîß ƒê·ªïi m·∫≠t kh·∫©u</button>
                        <button class="btn-delete" onclick="deleteAccount('${u.username}')">X√≥a</button>
                    </td>
                </tr>
            `;
        });

        document.getElementById("userTableBody").innerHTML =
          html ||
          "<tr><td colspan='6' align='center'>Ch∆∞a c√≥ kh√°ch h√†ng n√†o ƒëƒÉng k√Ω.</td></tr>";
      }

      // H√†m ·∫©n/hi·ªán m·∫≠t kh·∫©u
      function togglePassword(index, realPass) {
        const passSpan = document.getElementById(`pass-${index}`);
        if (passSpan.innerText === "******") {
          passSpan.innerText = realPass;
        } else {
          passSpan.innerText = "******";
        }
      }

      // H√†m thay ƒë·ªïi m·∫≠t kh·∫©u c·ªßa kh√°ch
      function changePassword(username) {
        const newPass = prompt(
          `Nh·∫≠p m·∫≠t kh·∫©u m·ªõi cho t√†i kho·∫£n "${username}":`,
        );

        if (newPass === null) return; // Kh√°ch nh·∫•n H·ªßy
        if (newPass.length < 6) {
          alert("L·ªói: M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!");
          return;
        }

        let users = JSON.parse(localStorage.getItem("usersList")) || [];
        let userIndex = users.findIndex((u) => u.username === username);

        if (userIndex !== -1) {
          users[userIndex].password = newPass; // C·∫≠p nh·∫≠t m·∫≠t kh·∫©u m·ªõi
          localStorage.setItem("usersList", JSON.stringify(users));
          alert(
            `‚úÖ ƒê√£ thay ƒë·ªïi m·∫≠t kh·∫©u cho t√†i kho·∫£n "${username}" th√†nh c√¥ng!`,
          );
          renderUsers();
        }
      }

      // H√†m x√≥a t√†i kho·∫£n (Gi·ªØ nguy√™n nh∆∞ c≈©)
      function deleteAccount(username) {
        if (
          confirm(
            `B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n "${username}" kh√¥ng?`,
          )
        ) {
          let users = JSON.parse(localStorage.getItem("usersList")) || [];
          users = users.filter((u) => u.username !== username);
          localStorage.setItem("usersList", JSON.stringify(users));
          localStorage.removeItem("balance_" + username);
          alert("ƒê√£ x√≥a t√†i kho·∫£n th√†nh c√¥ng!");
          renderUsers();
        }
      }

      window.onload = renderUsers;
    </script>
  </body>
</html>
