<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B·∫£ng ƒêi·ªÅu Khi·ªÉn Admin - Xu√¢n C√¥ng</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/home.css" />
    <style>
      :root {
        --admin-bg: #2c3e50;
        --accent: #e74c3c;
      }
      body {
        background: #f4f7f6;
        font-family: "Segoe UI", sans-serif;
      }
      /* T·ªëi ∆∞u Container linh ho·∫°t */
      .admin-container {
        padding: 20px;
        max-width: 1200px;
        margin: auto;
        width: 100%; /* ƒê·∫£m b·∫£o kh√¥ng b·ªã tr√†n tr√™n ƒëi·ªán tho·∫°i */
      }

      /* Header th√¥ng minh: T·ª± ƒë·ªông xu·ªëng h√†ng tr√™n ƒëi·ªán tho·∫°i 9:16 */
      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap; /* Cho ph√©p c√°c n√∫t t·ª± nh·∫£y d√≤ng khi m√†n h√¨nh h·∫πp */
        gap: 10px;
      }

      /* ƒêi·ªÅu ch·ªânh ti√™u ƒë·ªÅ v√† n√∫t b·∫•m khi xem tr√™n ƒëi·ªán tho·∫°i */
      @media (max-width: 768px) {
        .admin-header h1 {
          font-size: 1.5rem; /* Gi·∫£m c·ª° ch·ªØ ti√™u ƒë·ªÅ tr√™n mobile */
          width: 100%;
          text-align: center;
        }
        .admin-header a {
          flex: 1; /* C√°c n√∫t b·∫•m chia ƒë·ªÅu chi·ªÅu ngang m√†n h√¨nh d·ªçc */
          text-align: center;
          font-size: 13px;
          padding: 8px 5px;
        }
      }
      .btn-logout {
        background: #e74c3c;
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
      }
      .btn-logout:hover {
        background: #c0392b;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }
      .card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-left: 5px solid var(--admin-bg);
      }
      .card h3 {
        margin-bottom: 10px;
        color: #7f8c8d;
        font-size: 14px;
        text-transform: uppercase;
      }
      .card p {
        font-size: 22px;
        font-weight: bold;
        color: var(--admin-bg);
      }

      .section-box {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
      }
      .section-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #f8f9fa;
        color: #333;
      }

      .admin-input {
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 100%;
      }
      .btn {
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }
      .btn-update {
        background: #3498db;
        color: white;
      }
      .btn-add {
        background: #2c3e50;
        color: white;
        padding: 10px 20px;
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div class="admin-header">
        <h1 style="color: var(--admin-bg)">üíé Qu·∫£n Tr·ªã H·ªá Th·ªëng - Xu√¢n C√¥ng</h1>
        <a href="quanlytaikhoan.html" class="btn-logout"
          >üë• Qu·∫£n L√Ω T√†i Kho·∫£n
        </a>
        <a href="index.html" class="btn-logout">üö™ ƒêƒÉng xu·∫•t</a>
      </div>

      <div class="dashboard-grid">
        <div class="card" style="border-left-color: #3498db">
          <h3>Doanh Thu</h3>
          <p id="totalIncome">0ƒë</p>
        </div>
        <div class="card" style="border-left-color: #2ecc71">
          <h3>ƒê√£ Thu√™</h3>
          <p id="rentedCount">0</p>
        </div>
        <div class="card" style="border-left-color: #95a5a6">
          <h3>Ph√≤ng Tr·ªëng</h3>
          <p id="emptyCount">0</p>
        </div>
        <div class="card" style="border-left-color: #e67e22">
          <h3>Y√™u C·∫ßu N·∫°p</h3>
          <p id="pendingCount">0</p>
        </div>
      </div>
      <div
        class="section-box"
        style="border: 2px solid #e67e22; overflow-x: auto"
      >
        <div class="section-title">
          <h2 style="color: #e67e22">üì© Y√™u C·∫ßu N·∫°p Ti·ªÅn Ch·ªù Duy·ªát</h2>
        </div>
        <table>
          <thead>
            <tr>
              <th>Kh√°ch H√†ng</th>

              <th>S·ªë Ti·ªÅn</th>

              <th>Th·ªùi Gian</th>

              <th>H√†nh ƒê·ªông</th>
            </tr>
          </thead>

          <tbody id="pendingBody"></tbody>
        </table>
      </div>

      <div class="section-box" style="overflow-x: auto">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
          "
        >
          <h2 style="margin: 0; color: #2c3e50">
            üõ† QU·∫¢N L√ù V√Ä CH·ªàNH S·ª¨A PH√íNG
          </h2>
          <button class="btn-save" onclick="addNewRoom()">
            + TH√äM PH√íNG M·ªöI
          </button>
        </div>

        <table>
          <thead>
            <tr>
              <th>M√£ Ph√≤ng</th>
              <th>Lo·∫°i Ph√≤ng</th>
              <th>Kh√°ch thu√™</th>
              <th>Gi√° g·ªëc (VNƒê)</th>
              <th>Tr·∫°ng th√°i</th>
              <th>H√†nh ƒê·ªông</th>
            </tr>
          </thead>
          <tbody id="adminRoomList"></tbody>
        </table>
      </div>
    <script src="database.js"></script>
    <script>
      function renderAdmin() {
        const rooms = getRooms();
        const pending = getPendingRequests();
        const logs = getTransactions();

        // 1. Render y√™u c·∫ßu n·∫°p ti·ªÅn
        let pnlHtml = "";
        pending.forEach((req) => {
          pnlHtml += `<tr>
                <td><b>${req.user}</b></td>
                <td style="color: #27ae60; font-weight: bold;">${req.amount.toLocaleString()}ƒë</td>
                <td>${req.time}</td>
                <td>
                    <button class="btn btn-update" style="background: #27ae60" onclick="handleApprove('${req.id}')">Duy·ªát</button>
                    <button class="btn btn-update" style="background: #e74c3c; margin-left: 5px;" onclick="handleReject('${req.id}')">H·ªßy</button>
                </td>
            </tr>`;
        });
        document.getElementById("pendingBody").innerHTML =
          pnlHtml ||
          "<tr><td colspan='4' align='center'>Kh√¥ng c√≥ y√™u c·∫ßu n·∫°p ti·ªÅn n√†o.</td></tr>";

        // 2. Render danh s√°ch ph√≤ng
        let roomHtml = "";
        let rented = 0;
        // Th√™m n√∫t X√≥a v√†o c·ªôt cu·ªëi c√πng trong h√†m renderAdmin
        rooms.forEach((r) => {
          if (r.status === "ƒê√£ thu√™") rented++;
          roomHtml += `
    <tr>
        <td><b>${r.id}</b></td>
        <td>${r.type || "Ph√≤ng ƒê∆°n"}</td>
        <td><input type="text" id="guest-${r.id}" value="${r.guest}" class="admin-input" style="width: 100px;"></td>
        <td><input type="number" id="price-${r.id}" value="${r.price}" class="admin-input" style="width: 100px;"></td>
        <td>
            <select id="status-${r.id}" class="admin-input">
                <option value="ƒê√£ thu√™" ${r.status === "ƒê√£ thu√™" ? "selected" : ""}>ƒê√£ thu√™</option>
                <option value="C√≤n tr·ªëng" ${r.status === "C√≤n tr·ªëng" ? "selected" : ""}>C√≤n tr·ªëng</option>
            </select>
        </td>
        <td>
            <button class="btn-save" onclick="saveRoom('${r.id}')" style="background: #27ae60;">üíæ</button>
            <button class="btn-save" onclick="deleteRoom('${r.id}')" style="background: #e74c3c; margin-left: 5px;">üóëÔ∏è</button>
        </td>
    </tr>`;
        });
        document.getElementById("adminRoomList").innerHTML = roomHtml;

        // 3. C·∫≠p nh·∫≠t Dashboard
        let totalIncome = logs.reduce((sum, log) => sum + log.amount, 0);
        document.getElementById("totalIncome").innerText =
          totalIncome.toLocaleString() + "ƒë";
        document.getElementById("rentedCount").innerText = rented;
        document.getElementById("emptyCount").innerText = rooms.length - rented;
        document.getElementById("pendingCount").innerText = pending.length;
      }
      // H√†m x√≥a ph√≤ng d·ª©t ƒëi·ªÉm
      function deleteRoom(id) {
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn ph√≤ng ${id} kh√¥ng?`)) {
          let rooms = getRooms(); // L·∫•y danh s√°ch t·ª´ database.js
          let index = rooms.findIndex((r) => r.id === id);

          if (index !== -1) {
            rooms.splice(index, 1); // X√≥a ph√≤ng kh·ªèi m·∫£ng
            localStorage.setItem("ROOM_DATABASE", JSON.stringify(rooms)); // L∆∞u l·∫°i kho d·ªØ li·ªáu
            alert("‚úÖ ƒê√£ x√≥a ph√≤ng th√†nh c√¥ng!");
            renderAdmin(); // T·∫£i l·∫°i b·∫£ng ƒë·ªÉ th·∫•y k·∫øt qu·∫£
          }
        }
      }
      // H√ÄM DUY·ªÜT TI·ªÄN
      function handleApprove(id) {
        if (confirm("X√°c nh·∫≠n ƒë√£ nh·∫≠n ti·ªÅn v√† mu·ªën c·ªông v√†o v√≠ cho kh√°ch?")) {
          if (approveDeposit(id)) {
            alert("‚úÖ ƒê√£ duy·ªát n·∫°p ti·ªÅn th√†nh c√¥ng!");
            renderAdmin();
          }
        }
      }

      // H√ÄM H·ª¶Y Y√äU C·∫¶U
      function handleReject(id) {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën H·ª¶Y y√™u c·∫ßu n√†y?")) {
          if (rejectDeposit(id)) {
            alert("‚ùå ƒê√£ h·ªßy y√™u c·∫ßu.");
            renderAdmin();
          }
        }
      }

      function saveRoom(id) {
        const data = {
          guest: document.getElementById(`guest-${id}`).value,
          price: parseInt(document.getElementById(`price-${id}`).value),
          status: document.getElementById(`status-${id}`).value,
        };
        if (updateRoom(id, data)) {
          alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng!");
          renderAdmin();
        }
      }

      function addNewRoom() {
        const id = prompt("Nh·∫≠p m√£ ph√≤ng m·ªõi:");
        if (!id) return;
        const type = prompt("Lo·∫°i ph√≤ng:", "Ph√≤ng ƒê∆°n");
        const price = prompt("Gi√° thu√™:", "2000000");
        if (
          addRoom({
            id,
            type,
            price: parseInt(price),
            status: "C√≤n tr·ªëng",
            guest: "-",
          })
        ) {
          alert("‚úÖ ƒê√£ th√™m ph√≤ng!");
          renderAdmin();
        }
      }

      window.onload = renderAdmin;
    </script>
  </body>
</html>
